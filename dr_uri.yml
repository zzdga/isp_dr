
- name: "ISP {{ ambiente }} Environment DR Switch to {{ sito }} Site"
  hosts: localhost
  gather_facts: false

  pre_tasks:

    - assert:
        that: item is defined
      with_items:
        - ambiente
        - sito

    - name: Loading {{ ambiente }} Environment Settings for Site {{ sito }}
      include_vars: 
        dir: vars/{{ ambiente }}/{{ sito }}
        depth: 1

  tasks:

    - name: test URI
      uri:
        url: "{{ rest_api.uri }}"
        method: GET
        user: "{{ rest_api.usr }}"
        password: "{{ rest_api.pwd }}"
        force_basic_auth: yes
        return_content: yes
        validate_certs: no
        body_format: json
      register: uri_out

    - debug:
        var: uri_out

